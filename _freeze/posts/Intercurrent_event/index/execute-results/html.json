{
  "hash": "0606aeaa236b277d5322e501e63b70b5",
  "result": {
    "markdown": "---\ntitle: \"Intercurrent Events\"\nauthor: \"Yujing Gao\"\ndate: \"2025-06-05\"\ncategories: [intercurrent event, statistics, causal inference]\n---\n\n\n## 1. The General Introduction of Estimand Framework\n\nThe general introduction of estimand framework includes four parts:\n\n-   Trial Objective\n\n-   Estimand\n\n-   Main Estimator\n\n-   Main Estimate\n\nAn **estimand** is a precise description of the treatment effect reflecting the clinical question posed by a given clinical trial objective, via specifying five attributes: Population, Treatment, Endpoint, Population-level Summary, Intercurrent Events.\n\nThe **intercurrent event** is an event that occurs after treatment initiation and affects either the interpretation or existence of the measurements associated with the clinical outcome.\n\nThere are **five strategies (page 101-118 of ICH E9)** to deal with intercurrent events: treatment policy, hypothetical, composite variable, while on treatment, principal stratum.\n\n## 2. The Five Strategies\n\n### 2.1 Treatment Policy\n\nThe treatment policy strategy includes all post-randomization data, regardless of the intercurrent events. In this approach, the primary analysis treats the occurrence of intercurrent events as part of the real-world scenario. Thus, data is collected and analyzed as if all patients followed the initial treatment assignment, irrespective of deviations. (Intention to treat - ITT)\n\nExample: A clinical trial where patients switch to a different medication due to adverse effects, but all data (pre- and post-switch) are included in the primary analysis.\n\n\n::: {.cell layout-align=\"center\" paged.print='false'}\n::: {.cell-output-display}\n![](stg1.png){fig-align='center'}\n:::\n:::\n\n\n### 2.2 Hypothetical\n\nThe hypothetical strategy considers what the outcome would have been if the intercurrent event had not occurred. This strategy relies on assumptions to model the data based on a scenario where patients had continued as initially intended, disregarding the actual intercurrent events.\n\nExample: Estimating the effect of a drug assuming that all patients remained on the assigned treatment without any dropouts or additional medications.\n\nThe hypothetical scenario should consider reasonable situations, e.g. a scenario where a toxic medicine is considered to be non-toxic is not usually relevant for decision making.\n\n\n::: {.cell layout-align=\"center\" paged.print='false'}\n::: {.cell-output-display}\n![](stg2.png){fig-align='center'}\n:::\n:::\n\n\n### 2.3 Composite Variable\n\nIn the composite variable strategy, the intercurrent event is integrated into the outcome itself, redefining it as part of a combined endpoint. This method allows for a new outcome that includes both the clinical endpoint and the intercurrent event, allowing analyses to capture their joint effect.\n\nExample: For a heart disease trial, combining hospitalization and mortality as a composite endpoint, rather than separating them, captures the total adverse outcomes.\n\n\n::: {.cell layout-align=\"center\" paged.print='false'}\n::: {.cell-output-display}\n![](stg3.png){fig-align='center'}\n:::\n:::\n\n\n### 2.4 While-on-Treatment\n\nThe while-on-treatment strategy (also known as the on-treatment strategy) restricts analysis to data collected up until the occurrence of the intercurrent event. Once the intercurrent event occurs, further data is excluded from the analysis. This approach only considers the efficacy of the treatment while patients are actively taking it.\n\nExample: Including data from patients only while they adhere to the medication and excluding data collected after discontinuation or switch to another treatment.\n\n\n::: {.cell layout-align=\"center\" paged.print='false'}\n::: {.cell-output-display}\n![](stg4.png){fig-align='center'}\n:::\n:::\n\n\n### 2.5 Principal Stratum\n\nThe principal stratum strategy analyzes only a specific subset of patients defined by their response to the intercurrent event, such as those who would not experience the event regardless of the treatment they received. This strategy requires assumptions about which patients would fall into this subset and generally involves a more complex statistical model.\n\nExample: In a study where some patients are likely to need additional therapy, the analysis might focus only on those who would not require additional therapy regardless of the treatment arm they are in.\n\n\n::: {.cell layout-align=\"center\" paged.print='false'}\n::: {.cell-output-display}\n![](stg5.png){fig-align='center'}\n:::\n:::\n\n\n## 3. An Simple Example\n\nPrimary Estimand: to assess the outcome of new medicine (treatment group) as compared to old medicine (control group) in defined population who complete the treatment regimen.\n\n\n::: {.cell layout-align=\"center\" paged.print='false'}\n::: {.cell-output-display}\n![](simple_exp.png){fig-align='center'}\n:::\n:::\n\n\n## 4. Principal Stratification Framework\n\n### 4.1. Principal Strata\n\nUnder the potential outcome framework (Rubin, 1974), each subject has potential outcomes $S(z)$ and $Y(z)$, where $z=0,1$. Frangakis and Rubin (2002) defined the principal stratification variable, $U=S(1)S(0)$, where $S(0),S(1)\\in\\{0,1\\}$. Thus, there are four principal strata:\n\n * $U=00$: Never-adherence\n \n * $U=10$: Treatment-benefit adherence\n \n * $U=01$: Control-benefit adherence\n \n * $U=11$: Always-adherence\n\n\nTake $U=S(1)S(0) = 00$ Never-adherence as an example:\n\n - $S(1) = 0$: when subject is assigned to the treatment group, she/he will not adhere to the protocol.\n \n - $S(0) = 0$: when subject is assigned to the control group, she/he will not adhere to the protocol.\n\nBelow we show the relationship between principal strata and the observed strata.\n\n\n::: {.cell layout-align=\"center\" paged.print='false'}\n::: {.cell-output-display}\n![](relationship.png){fig-align='center'}\n:::\n:::\n\n\n### 4.2. Principal Causal Effects (PCEs)\n\nThe causal estimand here is defined as principal causal effects (PCEs):\n$$\\tau_{U=S(1)S(0)} = E\\{Y(1) - Y(0) | U = S(1)S(0)\\},\\quad S(1)S(0) = 00, 10, 11, 01.$$\n\nIn Section 2's example, our interested parameter is PCE in Always-adherence strata:\n$$\\tau_{11} = \\tau_{U=11} = E\\{Y(1) - Y(0)| U= 11\\}.$$\n\n### 4.3. Per-protocol Method\n\nHere we also list the target estimand in Per-protocol method using our notation:\n$$\\tau_{pp} = E(Y|Z=1,S=1) - E(Y|Z=0,S=1)$$\n\nIn Section 2's example, the interested parameter in the Per-protocol method corresponding to PCE in Always-adherence strata is:\n$$\\tau_{11} = \\tau_{U=11} = E\\{Y(1) - Y(0)| U= 11\\}.$$\n\nHowever, $\\tau_{11}$ is defined on the potential principal strata $U=S(1)S(0) = 11$, while $\\tau_{pp}$ is defined on the observed strata $(Z,S)$.\n\n\nHere we can use a simple table to show the relationship between principal strata abd observed strata:\n\n\n::: {.cell layout-align=\"center\" paged.print='false'}\n::: {.cell-output-display}\n![](simple_table.png){fig-align='center'}\n:::\n:::\n\n\nThus, if we use the Per-protocol method to estimate $\\tau_{11}$, $\\widehat{\\tau}_{pp}$ may not be an consistent estimator for $\\tau_{11}$ since it will be confounded by two other principal strata $U = 01$ and $U=10$.\n\n\n\n\n## 5. Principal Stratification Estimation Methods\n\n### 5.1. Most Recent Principal Stratification Methods:\n\nHere we first list the most recent principal stratification methods and provide one plot to show \nthe relationship among these methods.\n\n\n::: {.cell layout-align=\"center\" paged.print='false'}\n::: {.cell-output-display}\n![](recent_method.png){fig-align='center'}\n:::\n:::\n\n\n\n### 5.2 Identification Assumptions \n\n - **Assumption 1**: SUTVA (Stable Unit Treatment Value Assumption): There is no interference and no hidden variations of treatment.\n   - This assumption hold in the completely randomized trial.\n   \n - **Assumption 2**: Treatment Ignorability: $Z\\perp \\{S(0), S(1), Y(0), Y(1)\\}| \\boldsymbol{X}$.\n \n   - This assumption hold in the completely randomized trial.\n   \n - **Assumption 3**: Monotonicity: $S(1)\\geq S(0)$.\n   - This rules out stratum U=01 (Control-benefit adherence).\n   - This means: when participants are assigned to the treatment group, they are more likely to adhere to protocol comparing with when participants are assigned to the control group.\n   - Under Assumption 3, the relationship table between the principal strata and the observed strata changed.\n   - Now $\\tau_{pp}$ is still confounded by the principal strata $U=10$.\n   \n\n::: {.cell layout-align=\"center\" paged.print='false'}\n::: {.cell-output-display}\n![](relationship1.png){fig-align='center'}\n:::\n:::\n\n\n - **Assumption 4**: Principal Ignorability: \n $$E\\{Y(1) | U=11, \\boldsymbol{X}\\} = E\\{Y(1) | U=10, \\boldsymbol{X}\\} $$\n $$E\\{Y(0) | U=00, \\boldsymbol{X}\\} = E\\{Y(0) | U=10, \\boldsymbol{X}\\} $$\n \n    - This requires that the expectations of the potential outcome do not vary across some principal strata U conditional on the covariates.\n    - Take the first formula as an example. Under Assumption 1-3, the first formula is equivalent to \n    \\begin{align*}\n    Z=1,S=1:\\quad  & E\\{Y(1)| U = 11, Z=1,S=1, \\boldsymbol{X}\\} \\\\\n    = &  E\\{Y(1)| U = 10, Z=1, S=1, \\boldsymbol{X}\\}\\\\\n    = &  E\\{Y | Z=1,S=1,\\boldsymbol{X}\\}.\n    \\end{align*}\n    - This assumption help build an bridge to connect observed data with potential outcome. Thus, we can use observed data to estimate the principal causal effect.\n\n\n::: {.cell layout-align=\"center\" paged.print='false'}\n::: {.cell-output-display}\n![](relationship2.png){fig-align='center'}\n:::\n:::\n\n\n### 5.3 Principal Score Methods (Ding et al.; 2017)\n\n::: {.cell layout-align=\"center\" paged.print='false'}\n::: {.cell-output-display}\n![](method1.png){fig-align='center'}\n:::\n:::\n\n\n### 5.4 Multiple Robust Methods (Jiang et al.; 2017)\n\nFirst, we list two estimators that rely on propensity score model for Z and principal score model for S.\n\n::: {.cell layout-align=\"center\" paged.print='false'}\n::: {.cell-output-display}\n![](method2.png){fig-align='center'}\n:::\n:::\n\n\nNext, we introduce two estimators that rely on outcome mean model for Y, where \\texttt{tau11ref} also relies on propensity score model for Z and \\texttt{tau11reg2} relies on principal score model for S.\n\n\n::: {.cell layout-align=\"center\" paged.print='false'}\n::: {.cell-output-display}\n![](method3.png){fig-align='center'}\n:::\n:::\n\n\nFinally, we present the triply robust estimator, which relies on all three models: propensity score model for Z, principal score model for S and outcome mean mdoel for Y.\n\n\n::: {.cell layout-align=\"center\" paged.print='false'}\n::: {.cell-output-display}\n![](method4.png){fig-align='center'}\n:::\n:::\n\n\n\n## 6. Simple Simulation\n\nIn this section, we use an simple simulation to show the codes for these principal stratification estimation methods and the Per-protocol method.\n\n### 6.1 Setting\nWe follow the setting in Section 2.1, where we have three baseline variables:\n\n * $X_1$: Sex, binary, Bernoulli distribution with probability 0.5 as 1 (female)\n \n * $X_2$: Some transformed variable, binary, Bernoulli distribution with probability 0.8 as 1\n \n * $X_3$: Age, continuous, normal distribution with mean 50 and variance 8\n\nIn addition, we use the logistic model to generate the intercurrent event:\n\n$$P(S=1|Z, \\boldsymbol{X}) = logistc(-1 + 0.15Z +0.6X_1 + 0.8 X_2 + 0.05*X_3 )$$\nand we use the linear regression model to generate the observed outcome:\n\n$$ Y = 0.5 - 0.7Z + 0.2S - 0.1X_1 +0.2 X_2 + 0.1X_3 + 0.1X_3Z + 0.1 X_3 S + \\epsilon$$\nwhere $\\epsilon\\sim N(0, \\sigma^2 = 0.6^2Z + 0.65^2(1-Z))$.\n\n\n\n::: {.cell paged.print='false'}\n\n```{.r .cell-code}\n########################################\n# Basic functions for generating simulated data\n########################################\n\n{\n  gen_Z <- function(num = 1){\n    return(rbinom(1, 1, prob = 1/2))\n  }\n  \n  gen_X <- function(num = 1){\n    res <- as.matrix(c(1, rnorm(4, mean = 0, sd = 1), rbinom(1, size = 1, prob = 1/2)), ncol = 1)\n    return(res)\n  }\n  \n  multi_logit_ss <- function(Xi,\n                             theta_logit_ss,\n                             theta_logit_s1s1,\n                             theta_logit_ss1){\n    Xi <- t(Xi)\n    res_ss <- exp(theta_logit_ss %*% Xi) / (exp(theta_logit_ss %*% Xi) + \n                                              exp(theta_logit_s1s1 %*% Xi) +\n                                              exp(theta_logit_ss1 %*% Xi))\n    return(res_ss)\n  }\n  \n  multi_logit_s1s1 <- function(Xi,\n                               theta_logit_ss,\n                               theta_logit_s1s1,\n                               theta_logit_ss1){\n    Xi <- t(Xi)\n    res_s1s1 <- exp(theta_logit_s1s1 %*% Xi) / (exp(theta_logit_ss %*% Xi) + \n                                                  exp(theta_logit_s1s1 %*% Xi) +\n                                                  exp(theta_logit_ss1 %*% Xi))\n    return(res_s1s1)\n  }\n  \n  multi_logit_ss1 <- function(Xi,\n                              theta_logit_ss,\n                              theta_logit_s1s1,\n                              theta_logit_ss1){\n    Xi <- t(Xi)\n    res_ss1 <- exp(theta_logit_ss1 %*% Xi) / (exp(theta_logit_ss %*% Xi) + \n                                                exp(theta_logit_s1s1 %*% Xi) +\n                                                exp(theta_logit_ss1 %*% Xi))\n    return(res_ss1)\n  }\n  \n  prob_U <- function(Xi,\n                     theta_logit_ss,\n                     theta_logit_s1s1,\n                     theta_logit_ss1){\n    Xi <- t(Xi)\n    prob <- c(multi_logit_ss(Xi,\n                             theta_logit_ss,\n                             theta_logit_s1s1,\n                             theta_logit_ss1),\n              multi_logit_s1s1(Xi,\n                               theta_logit_ss,\n                               theta_logit_s1s1,\n                               theta_logit_ss1),\n              multi_logit_ss1(Xi,\n                              theta_logit_ss,\n                              theta_logit_s1s1,\n                              theta_logit_ss1)\n    )\n    return(prob)\n  }\n  \n  sample_strata <- function(prob){\n    return(sample(c(1,2,3), size = 1, prob = prob))\n  }\n  \n  gen_S <- function(Z, strata){\n    if(strata == 1){ # always-taker\n      return(c(1))\n    }else if(strata == 2){ # never-taker\n      return(c(0))\n    }else{ # complier \n      return(Z)\n    }\n  }\n  \n  gen_Y0 <- function(strata, X){\n    mu_Y0 <- sum(X[2:6]) + 1*(strata == 1) + 1 # strata = 1 - always-taker\n    res <- rnorm(1, mean = mu_Y0, sd = 1)\n    return(res)\n  }\n  \n  gen_Y1 <- function(strata, X){\n    mu_Y1 <- sum(X[2:6]) - 1*(strata == 2) + 4 # strata = 2 - never-taker\n    res <- rnorm(1, mean = mu_Y1, sd = 1)\n    return(res)\n  }\n  \n  gen_Y <- function(# strata, \n                    Z, Y0, Y1){\n    # if(strata == 1){ # always-taker\n    #   return(c(Y1))\n    # }else if(strata == 2){ # never-taker\n    #   return(c(Y0))\n    # }else{ # complier \n    #   return(Z*Y1 + (1-Z)*Y0)\n    # }\n    return(Z*Y1 + (1-Z)*Y0)\n  }\n  \n}\n```\n:::\n\n### 6.2 Estimation\n \n Here we show R codes for doing simulation\n \n \n\n\n\n\n## Reference\n\n - D. B. Rubin. Estimating causal effects of treatments in randomized and nonrandomized\nstudies. J Educ Psychol, 66(5): 688–701, 1974.\n - C.E. Frangakis and D. B. Rubin. Principal stratification in causal inference. Biometrics, 58(1):21–29, 2002.\n - P. Ding and J. Lu. Principal stratification analysis using principal scores. Journal of the Royal Statistical Society Series B: Statistical Methodology, 79(3):757–777, 2017.\n - Z. Jiang, S. Yang, and P. Ding. Multiply robust estimation of causal effects under principal ignorability. Journal of the Royal Statistical Society Series B: Statistical Methodology, 84(4):1423–1445, 2022.\n\n\n\n\n\n\n\n\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}